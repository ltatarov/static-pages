function WDSKeepAliveSession(threshold,timeOut,interval,extendCathaySessionUrl,extendSessionUrl,firstText,firstTextLastTime,firstButton,secondText,secondButton,disableFacade,requestedPage){var self=this;this.requestedPage=requestedPage;this.iteration=0;this.firstTextLastTime=firstTextLastTime;this.threshold=threshold;this.beforeTimeOut=timeOut-threshold;this.timeOut=timeOut;this.interval=interval;this.extendCathaySessionUrl=extendCathaySessionUrl;this.extendSessionUrl=extendSessionUrl;this.modalDialog=new WDSModalDialog("popTMOT",true);$("#extendSessionButton").click(function(){self.extendSession(disableFacade);});$("#closeDialogButton").click(function(){self.goToHome();});$("#extendSession").html(firstButton);$("#closeDialog").html(secondButton);$("#firstText").html(firstText);$("#secondText").html(secondText);this.init();}WDSKeepAliveSession.prototype.init=function(){this.iteration++;var self=this;if(this.iteration==2){this.timeOut=600;this.beforeTimeOut=600-this.threshold;}var remainingTime=(this.beforeTimeOut<0)?this.timeOut:(this.timeOut-this.beforeTimeOut);this.sessionTimeOut=setTimeout(function(){var displayPopin=true;if(self.requestedPage=="ALPI"&&$("#popin").is(":visible")){displayPopin=false;}else{if($("#WDSWaitingImageDivID").is(":visible")){displayPopin=false;}}if(displayPopin){self.openDialog();}self.updateDialogTime(remainingTime,self.interval);},this.beforeTimeOut*1000);};WDSKeepAliveSession.prototype.initLastPopin=function(){this.iteration++;var self=this;this.sessionTimeOut=setTimeout(function(){$("#timeIsOut").css("display","");$("#timeIsNotOut").css("display","none");$("#closeDialog").css("display","");self.openDialog();},600000);};WDSKeepAliveSession.prototype.extendSession=function(disableFacade){this.closeDialog();if(this.iteration==1){$("#firstText").html(this.firstTextLastTime);$("#remainingTimeLeftInfo").css("display","");}$("#timeIsOut").css("display","none");$("#timeIsNotOut").css("display","");clearTimeout(this.sessionTimeOut);clearInterval(this.timer);if(this.iteration!=2){this.init();}else{this.initLastPopin();}if(self.requestedPage=="PURC"&&this.iteration==2){this._onPaymentSessionTimeout();}$.ajax({dataType:"text",cache:false,type:"POST",url:this.extendSessionUrl,success:function(data){},error:function(request,error){}});if(disableFacade=="FALSE"){$.ajax({dataType:"json",type:"GET",url:this.extendCathaySessionUrl,success:function(data){},error:function(request,error){}});}};WDSKeepAliveSession.prototype.updateDialogTime=function(time,interval){var self=this;self.updateUITime(time);this.timer=setInterval(updateTime,interval*1000);function updateTime(){time-=interval;self.updateUITime(time);if(time<=0){clearInterval(this.timer);$("#timeIsOut").css("display","");$("#timeIsNotOut").css("display","none");$("#closeDialog").css("display","");}}};WDSKeepAliveSession.prototype.updateUITime=function(remainingTime){var minRemaining=Math.floor(remainingTime/60);var finalMinRemaining=(minRemaining<10?"0"+minRemaining:minRemaining);var secRemaining=remainingTime%60;var finalSecRemaining=(secRemaining<10?"0"+secRemaining:secRemaining);$("#minRemaining").html(finalMinRemaining);$("#secRemaining").html(finalSecRemaining);};WDSKeepAliveSession.prototype.openDialog=function(){this._modifiyZIndexMask("2000");this.modalDialog.open();};WDSKeepAliveSession.prototype.closeDialog=function(){this._modifiyZIndexMask("2000");this.modalDialog.close();};WDSKeepAliveSession.prototype.goToHome=function(){window.setTimeout(function(){document.GO_TO_HOME.submit();},1000);};WDSKeepAliveSession.prototype._onPaymentSessionTimeout=function(){WDSError.add(WDSMessage.getMessage(this.requestedPage+".text.sessionTimeout"));$("#purchaseButton").attr("disabled","disabled");$("#purchaseButton").addClass("disabled");this._displayTimeoutMessage();};WDSKeepAliveSession.prototype._displayTimeoutMessage=function(){if(WDSError.hasError()){WDSError.show();}};WDSKeepAliveSession.prototype._modifiyZIndexMask=function(zindex){$("#wdsPopupMask").css("z-index",zindex);};