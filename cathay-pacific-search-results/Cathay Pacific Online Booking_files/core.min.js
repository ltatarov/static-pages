/*! CxopCore | 2015-12-10 02:55:47 */
window.CxopCore=function(){function a(a){for(var b in a)a.hasOwnProperty(b)&&(v[b]||(v[b]=[]),(Array.isArray(a[b])?a[b]:[a[b]]).forEach(function(a){v[b].push({rule:a,ruleid:"rule"+w++ +"("+b+")",selector:b})}));f(null,"added rules"+a+"so there are now these selectors with rules:"+Object.keys(v)),m(a,"New rule addition")}function b(a){for(var b in a)a.hasOwnProperty(b)&&(A[b]=a[b])}function c(a){if(!t){var b=document.getElementsByTagName("html")[0].getAttribute("lang");t=b?b:"en"}return A[a]&&A[a][t]?A[a][t]:a}function d(a){C=a}function e(a){D=a?Array.isArray(a)?a:[a]:!1}function f(){if(C){var a=[].slice.call(arguments),b=a.shift(),c=!1;if(null===b?c=!0:D?-1!==D.indexOf(b)&&(c=!0):c=!0,c){var d=b||"core",e=["["+d+"]"].concat(a);try{console.log.apply(console,e)}catch(f){for(var g="",h=0;h<e.length;h++)g+=e[h].toString()+" ";console.log(g)}}}}function g(a){E=a}function h(){for(var a=["WebKit","Moz","O","Ms",""],b=0;b<a.length;b++)if(a[b]+"MutationObserver"in window)return window[a[b]+"MutationObserver"];return!1}function i(a){for(var b in v)a.matches&&a.matches(b)&&l(v[b],a)}function j(a){a.forEach(function(a){switch(a.type){case"attributes":i(a.target);break;case"childList":a.addedNodes&&Array.prototype.slice.call(a.addedNodes).forEach(i)}})}function k(a){m(v,"mutation observer init");var b=new a(j);b.observe(document,{attributes:!0,subtree:!0,childList:!0})}function l(a,b){a.forEach(function(a){function c(c){clearTimeout(d),y[a.selector]||(y[a.selector]=0),y[a.selector]+=1,f(a.selector,"Processed element "+b.nodeName+" with rule id "+a.ruleid+" and sending AAProcessed event");var e=document.createEvent("CustomEvent");e.selector=a.selector,e.element=b,e.initEvent("AAProcessed",!0,!1),document.dispatchEvent(e),z[c]||(z[c]=0),z[c]+=1}var d;if(x[a.ruleid]&&-1!==x[a.ruleid].indexOf(b))return void f(a.selector,"Not processing "+b.nodeName+" with rule id "+a.ruleid+" because it has already been processed");if(d=setTimeout(function(){f(a.selector,"Rule never returned")},5e3),f(a.selector,"About to process element "+b.nodeName+" with rule id "+a.ruleid),x[a.ruleid]||(x[a.ruleid]=[]),x[a.ruleid].push(b),E)try{a.rule(b,c)}catch(e){f(a.selector,"RULE ERROR in rule "+a.selector,e)}else a.rule(b,c)})}function m(a,b){f(null,"finding unprocessed matching elements, executed from",b);for(var c in v)if(v.hasOwnProperty(c)){if(-1!==I.indexOf(c)){-1===J.indexOf(c)&&(f(c,"Would have run rule(s) for this selector but it was explicitly suppressed"),J.push(c));continue}f(c,c,"checking rule for selector"),Array.prototype.slice.call(document.querySelectorAll(c)).forEach(function(a){f(c,c,a.nodeName,"checking element"),l(v[c],a)})}}function n(a,b){function c(a){document.getElementsByTagName("head")[0].appendChild(a)}if(F[a]&&b)return void f(a,"[addCSS] ERROR: tried to add CSS text for a selector in wellKnownCSS, which is not allowed.");if(!F[a]&&!b)return void f(a,"[addCSS] ERROR: tried to add well known CSS but the selector "+a+" is not in wellKnownCSS");var d=b||F[a].join("\n");if(-1!==G.indexOf(a+d))return void f(a,"[addCSS] We've already added this one ("+a+"); don't do it again.");var e=document.getElementById("CxopStyle");if(!e){f(a,"[addCSS] Creating new style element for addCSS()ed styles"),e=document.createElement("style"),e.setAttribute("type","text/css"),e.setAttribute("id","CxopStyle"),e.appendChild(document.createTextNode(""));var g=document.getElementsByTagName("head");0===g.length?setTimeout(function(){c(e)},50):c(e)}e.sheet&&e.sheet.insertRule?e.sheet.insertRule(a+" { "+d+" }",0):e.sheet&&e.sheet.addRule&&e.sheet.addRule(a,d,0),f(a,"[addCSS] Added CSS styles for selector '"+a+"'"+(b?" -> "+b.substr(0,30)+"...":"")),G.push(a+d)}function o(){if(!h())throw new Error("Attempted to force mutation observers to be used in a browser that doesn't support them.");clearInterval(u),H=!0}function p(){if(window.localStorage){var a=localStorage.getItem("CxopCoreOverrides");if(a){try{a=JSON.parse(a)}catch(b){return void console.log(null,"CxopCoreOverrides localStorage variable existed but contained invalid JSON.")}for(var c in a)K[c]&&"function"==typeof K[c]&&(console.log(null,"CxopCoreOverrides: "+c+"("+a[c]+")"),K[c](a[c]))}}}function q(a){if(!Array.isArray(a))return void console.log("Expected suppressRulesWithSelectors to be called with a list");var b=a.filter(function(a){return"string"!=typeof a});return b.length>0?void console.log("Expected suppressRulesWithSelectors to be called with a list of strings"):void(I=a)}function r(){return z}function s(){p(),f(null,"CxopCore startup");var a,b=h();b?(k(b),f(null,"Enabling mutation observers"),a=2e3):(f(null,"Mutation observers not supported"),a=500),H||(u=setInterval(function(){m(v,"regular interval")},a))}window.console||(window.console={log:function(){}});var t,u,v={},w=0,x={},y={},z={},A={},B={opensInNewWindow:function(a,b){CxopCore.addCSS(".hidden-accessible"),CxopCore.addCSS(".icon-newpage:before");var c=a.parentNode.getAttribute("title");c&&a.parentNode.setAttribute("data-sa-title",c),a.parentNode.removeAttribute("title");var d=document.createElement("span");d.setAttribute("aria-hidden","true"),d.className="icon-newpage",a.parentNode.replaceChild(d,a);var e=document.createElement("span");return e.className="hidden-accessible",b===!0?e.appendChild(document.createTextNode(CxopCore.tr("Link opens external site in a new window"))):e.appendChild(document.createTextNode(CxopCore.tr("Link opens in a new window"))),d.parentNode.insertBefore(e,d),d.parentNode.insertBefore(document.createTextNode(" "),e),d},renameElementWithoutEventHandlers:function(a,b){var c=document.createElement(b);for(Array.prototype.slice.call(a.attributes).forEach(function(a){a.specified&&c.setAttribute(a.name,a.value)});a.hasChildNodes();)c.appendChild(a.firstChild);return a.parentNode.replaceChild(c,a),c}},C=!1,D=!1,E=!0,F={".hidden-accessible":["border: 0;","clip: rect(0 0 0 0);","height: 1px;","width: 1px;","margin: -1px;","padding: 0;","overflow: hidden;","position: absolute;"],".icon-newpage:before":['content: "\\e03f";']},G=[],H=!1,I=[],J=[],K={common:B,addRules:a,addCSS:n,addTranslations:b,tr:c,setLogging:d,logTheseSelectorsOnly:e,setTrapErrors:g,forceMutationObserversOnly:o,ruleActivatedCount:y,suppressRulesWithSelectors:q,getRulesRunAndCompleted:r};return s(),K}();
//# sourceMappingURL=core.min.js.map